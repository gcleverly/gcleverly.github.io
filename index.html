<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Griffin Cleverly Blog</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"><!--changed-->
    	<meta charset="utf-8"><!--changed-->
	    <meta name="viewport" content="width=device-width, initial-scale=1.0"><!--changed-->

        <!--changed<link rel="stylesheet" href="/theme/css/main.css" />-->
        <!--changed<link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />-->

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li><a href="/category/machine-learning.html">Machine Learning</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/kobe-shot-predictor.html">Kobe shot predictor</a></h1>
<footer class="post-info">
        <abbr class="published" title="2016-08-15T00:00:00+00:00">
                Published: Mon 15 August 2016
        </abbr>

<p>In <a href="/category/machine-learning.html">Machine Learning</a>.</p>
<p><a href="/index_copy.html">Old Page</a>.</p>
<p><a href="/index_new.html">Second Try</a>.</p>

</footer><!-- /.post-info --><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">reset</span>
</pre></div>


<div class="highlight"><pre><span></span>Once deleted, variables cannot be recovered. Proceed (y/[n])? y
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">cross_validation</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span><span class="p">,</span> <span class="n">RFE</span><span class="p">,</span> <span class="n">SelectKBest</span><span class="p">,</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">xgboost.sklearn</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="c1">#from sklearn.cross_validation import cross_val_score</span>
<span class="c1">#from sklearn.cross_validation import KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">GradientBoostingClassifier</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data.csv&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>game_event_id</th>
      <th>game_id</th>
      <th>lat</th>
      <th>loc_x</th>
      <th>loc_y</th>
      <th>lon</th>
      <th>minutes_remaining</th>
      <th>period</th>
      <th>playoffs</th>
      <th>seconds_remaining</th>
      <th>shot_distance</th>
      <th>shot_made_flag</th>
      <th>team_id</th>
      <th>shot_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>30697.000000</td>
      <td>25697.000000</td>
      <td>30697</td>
      <td>30697.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>249.190800</td>
      <td>24764065.868065</td>
      <td>33.953192</td>
      <td>7.110499</td>
      <td>91.107535</td>
      <td>-118.262690</td>
      <td>4.885624</td>
      <td>2.519432</td>
      <td>0.146562</td>
      <td>28.365085</td>
      <td>13.437437</td>
      <td>0.446161</td>
      <td>1610612747</td>
      <td>15349.000000</td>
    </tr>
    <tr>
      <th>std</th>
      <td>150.003712</td>
      <td>7755174.890198</td>
      <td>0.087791</td>
      <td>110.124578</td>
      <td>87.791361</td>
      <td>0.110125</td>
      <td>3.449897</td>
      <td>1.153665</td>
      <td>0.353674</td>
      <td>17.478949</td>
      <td>9.374189</td>
      <td>0.497103</td>
      <td>0</td>
      <td>8861.604943</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2.000000</td>
      <td>20000012.000000</td>
      <td>33.253300</td>
      <td>-250.000000</td>
      <td>-44.000000</td>
      <td>-118.519800</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1610612747</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>110.000000</td>
      <td>20500077.000000</td>
      <td>33.884300</td>
      <td>-68.000000</td>
      <td>4.000000</td>
      <td>-118.337800</td>
      <td>2.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>13.000000</td>
      <td>5.000000</td>
      <td>0.000000</td>
      <td>1610612747</td>
      <td>7675.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>253.000000</td>
      <td>20900354.000000</td>
      <td>33.970300</td>
      <td>0.000000</td>
      <td>74.000000</td>
      <td>-118.269800</td>
      <td>5.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>28.000000</td>
      <td>15.000000</td>
      <td>0.000000</td>
      <td>1610612747</td>
      <td>15349.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>368.000000</td>
      <td>29600474.000000</td>
      <td>34.040300</td>
      <td>95.000000</td>
      <td>160.000000</td>
      <td>-118.174800</td>
      <td>8.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>43.000000</td>
      <td>21.000000</td>
      <td>1.000000</td>
      <td>1610612747</td>
      <td>23023.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>659.000000</td>
      <td>49900088.000000</td>
      <td>34.088300</td>
      <td>248.000000</td>
      <td>791.000000</td>
      <td>-118.021800</td>
      <td>11.000000</td>
      <td>7.000000</td>
      <td>1.000000</td>
      <td>59.000000</td>
      <td>79.000000</td>
      <td>1.000000</td>
      <td>1610612747</td>
      <td>30697.000000</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>action_type</th>
      <th>combined_shot_type</th>
      <th>game_event_id</th>
      <th>game_id</th>
      <th>lat</th>
      <th>loc_x</th>
      <th>loc_y</th>
      <th>lon</th>
      <th>minutes_remaining</th>
      <th>period</th>
      <th>...</th>
      <th>shot_type</th>
      <th>shot_zone_area</th>
      <th>shot_zone_basic</th>
      <th>shot_zone_range</th>
      <th>team_id</th>
      <th>team_name</th>
      <th>game_date</th>
      <th>matchup</th>
      <th>opponent</th>
      <th>shot_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>10</td>
      <td>20000012</td>
      <td>33.9723</td>
      <td>167</td>
      <td>72</td>
      <td>-118.1028</td>
      <td>10</td>
      <td>1</td>
      <td>...</td>
      <td>2PT Field Goal</td>
      <td>Right Side(R)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>1610612747</td>
      <td>Los Angeles Lakers</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>12</td>
      <td>20000012</td>
      <td>34.0443</td>
      <td>-157</td>
      <td>0</td>
      <td>-118.4268</td>
      <td>10</td>
      <td>1</td>
      <td>...</td>
      <td>2PT Field Goal</td>
      <td>Left Side(L)</td>
      <td>Mid-Range</td>
      <td>8-16 ft.</td>
      <td>1610612747</td>
      <td>Los Angeles Lakers</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>35</td>
      <td>20000012</td>
      <td>33.9093</td>
      <td>-101</td>
      <td>135</td>
      <td>-118.3708</td>
      <td>7</td>
      <td>1</td>
      <td>...</td>
      <td>2PT Field Goal</td>
      <td>Left Side Center(LC)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>1610612747</td>
      <td>Los Angeles Lakers</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>43</td>
      <td>20000012</td>
      <td>33.8693</td>
      <td>138</td>
      <td>175</td>
      <td>-118.1318</td>
      <td>6</td>
      <td>1</td>
      <td>...</td>
      <td>2PT Field Goal</td>
      <td>Right Side Center(RC)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>1610612747</td>
      <td>Los Angeles Lakers</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Driving Dunk Shot</td>
      <td>Dunk</td>
      <td>155</td>
      <td>20000012</td>
      <td>34.0443</td>
      <td>0</td>
      <td>0</td>
      <td>-118.2698</td>
      <td>6</td>
      <td>2</td>
      <td>...</td>
      <td>2PT Field Goal</td>
      <td>Center(C)</td>
      <td>Restricted Area</td>
      <td>Less Than 8 ft.</td>
      <td>1610612747</td>
      <td>Los Angeles Lakers</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#Try and find which columns are necessary</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">unique_count</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;has&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_count</span><span class="p">),</span> <span class="s2">&quot; unique data entries over:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>action_type has 57  unique data entries over: 30697
combined_shot_type has 6  unique data entries over: 30697
game_event_id has 620  unique data entries over: 30697
game_id has 1559  unique data entries over: 30697
lat has 457  unique data entries over: 30697
loc_x has 489  unique data entries over: 30697
loc_y has 457  unique data entries over: 30697
lon has 489  unique data entries over: 30697
minutes_remaining has 12  unique data entries over: 30697
period has 7  unique data entries over: 30697
playoffs has 2  unique data entries over: 30697
season has 20  unique data entries over: 30697
seconds_remaining has 60  unique data entries over: 30697
shot_distance has 74  unique data entries over: 30697
shot_made_flag has 3  unique data entries over: 30697
shot_type has 2  unique data entries over: 30697
shot_zone_area has 6  unique data entries over: 30697
shot_zone_basic has 7  unique data entries over: 30697
shot_zone_range has 5  unique data entries over: 30697
team_id has 1  unique data entries over: 30697
team_name has 1  unique data entries over: 30697
game_date has 1559  unique data entries over: 30697
matchup has 74  unique data entries over: 30697
opponent has 33  unique data entries over: 30697
shot_id has 30697  unique data entries over: 30697
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s start removing the columns that won&#39;t be of use</span>
<span class="n">shot_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">shot_data</span> <span class="o">=</span> <span class="n">shot_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;team_id&#39;</span><span class="p">,</span><span class="s1">&#39;team_name&#39;</span><span class="p">,</span><span class="s1">&#39;game_id&#39;</span><span class="p">,</span><span class="s1">&#39;game_event_id&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">shot_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>action_type</th>
      <th>combined_shot_type</th>
      <th>lat</th>
      <th>loc_x</th>
      <th>loc_y</th>
      <th>lon</th>
      <th>minutes_remaining</th>
      <th>period</th>
      <th>playoffs</th>
      <th>season</th>
      <th>...</th>
      <th>shot_distance</th>
      <th>shot_made_flag</th>
      <th>shot_type</th>
      <th>shot_zone_area</th>
      <th>shot_zone_basic</th>
      <th>shot_zone_range</th>
      <th>game_date</th>
      <th>matchup</th>
      <th>opponent</th>
      <th>shot_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>33.9723</td>
      <td>167</td>
      <td>72</td>
      <td>-118.1028</td>
      <td>10</td>
      <td>1</td>
      <td>0</td>
      <td>2000-01</td>
      <td>...</td>
      <td>18</td>
      <td>NaN</td>
      <td>2PT Field Goal</td>
      <td>Right Side(R)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>34.0443</td>
      <td>-157</td>
      <td>0</td>
      <td>-118.4268</td>
      <td>10</td>
      <td>1</td>
      <td>0</td>
      <td>2000-01</td>
      <td>...</td>
      <td>15</td>
      <td>0</td>
      <td>2PT Field Goal</td>
      <td>Left Side(L)</td>
      <td>Mid-Range</td>
      <td>8-16 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>33.9093</td>
      <td>-101</td>
      <td>135</td>
      <td>-118.3708</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>2000-01</td>
      <td>...</td>
      <td>16</td>
      <td>1</td>
      <td>2PT Field Goal</td>
      <td>Left Side Center(LC)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>33.8693</td>
      <td>138</td>
      <td>175</td>
      <td>-118.1318</td>
      <td>6</td>
      <td>1</td>
      <td>0</td>
      <td>2000-01</td>
      <td>...</td>
      <td>22</td>
      <td>0</td>
      <td>2PT Field Goal</td>
      <td>Right Side Center(RC)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>4</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Driving Dunk Shot</td>
      <td>Dunk</td>
      <td>34.0443</td>
      <td>0</td>
      <td>0</td>
      <td>-118.2698</td>
      <td>6</td>
      <td>2</td>
      <td>0</td>
      <td>2000-01</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>2PT Field Goal</td>
      <td>Center(C)</td>
      <td>Restricted Area</td>
      <td>Less Than 8 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s convert game_date to a datetime object</span>
<span class="n">shot_data</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">shot_data</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span> <span class="o">=</span> <span class="n">shot_data</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">shot_data</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">True</span><span class="p">]</span>
<span class="n">data_submit</span> <span class="o">=</span> <span class="n">data_submit</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">data_complete</span> <span class="o">=</span> <span class="n">shot_data</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">shot_data</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="bp">False</span><span class="p">]</span>
<span class="n">data_complete</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s see how Kobe shot over time</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;season&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_10_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#It&#39;s clear that Kobe&#39;s shooting has fluctuated over the season. Let&#39;s see within a season what it looks like. </span>
<span class="c1">#Just for the sample lets look at the year 2000</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">year_2000</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[(</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2000-12-31&#39;</span><span class="p">)]</span>
<span class="n">year_2000</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>action_type</th>
      <th>combined_shot_type</th>
      <th>lat</th>
      <th>loc_x</th>
      <th>loc_y</th>
      <th>lon</th>
      <th>minutes_remaining</th>
      <th>period</th>
      <th>playoffs</th>
      <th>...</th>
      <th>shot_distance</th>
      <th>shot_made_flag</th>
      <th>shot_type</th>
      <th>shot_zone_area</th>
      <th>shot_zone_basic</th>
      <th>shot_zone_range</th>
      <th>game_date</th>
      <th>matchup</th>
      <th>opponent</th>
      <th>shot_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>34.0443</td>
      <td>-157</td>
      <td>0</td>
      <td>-118.4268</td>
      <td>10</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>15</td>
      <td>0</td>
      <td>2PT Field Goal</td>
      <td>Left Side(L)</td>
      <td>Mid-Range</td>
      <td>8-16 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>33.9093</td>
      <td>-101</td>
      <td>135</td>
      <td>-118.3708</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>16</td>
      <td>1</td>
      <td>2PT Field Goal</td>
      <td>Left Side Center(LC)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>33.8693</td>
      <td>138</td>
      <td>175</td>
      <td>-118.1318</td>
      <td>6</td>
      <td>1</td>
      <td>0</td>
      <td>...</td>
      <td>22</td>
      <td>0</td>
      <td>2PT Field Goal</td>
      <td>Right Side Center(RC)</td>
      <td>Mid-Range</td>
      <td>16-24 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Driving Dunk Shot</td>
      <td>Dunk</td>
      <td>34.0443</td>
      <td>0</td>
      <td>0</td>
      <td>-118.2698</td>
      <td>6</td>
      <td>2</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>2PT Field Goal</td>
      <td>Center(C)</td>
      <td>Restricted Area</td>
      <td>Less Than 8 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>5</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Jump Shot</td>
      <td>Jump Shot</td>
      <td>34.0553</td>
      <td>-145</td>
      <td>-11</td>
      <td>-118.4148</td>
      <td>9</td>
      <td>3</td>
      <td>0</td>
      <td>...</td>
      <td>14</td>
      <td>0</td>
      <td>2PT Field Goal</td>
      <td>Left Side(L)</td>
      <td>Mid-Range</td>
      <td>8-16 ft.</td>
      <td>2000-10-31</td>
      <td>LAL @ POR</td>
      <td>POR</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 22 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">year_2000</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;game_date&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;game_date&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_13_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#As we can see from the data, there are some nights where Kobe has a really hot hand and others when does poorly</span>
<span class="c1">#This brings up an interesting thought though, does Kobe consistently shoot a certain way on a monthly basis? </span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">year_2000</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_2000</span><span class="p">[</span><span class="s2">&quot;game_date&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span>
</pre></div>


<div class="highlight"><pre><span></span>//anaconda/lib/python3.5/site-packages/ipykernel/__main__.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  if __name__ == &#39;__main__&#39;:
</pre></div>


<div class="highlight"><pre><span></span><span class="n">year_2000</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;day_of_week&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_16_0.png" /></p>
<div class="highlight"><pre><span></span><span class="n">year_2000</span><span class="p">[</span><span class="s1">&#39;game_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_2000</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
</pre></div>


<div class="highlight"><pre><span></span>//anaconda/lib/python3.5/site-packages/ipykernel/__main__.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
  if __name__ == &#39;__main__&#39;:
</pre></div>


<div class="highlight"><pre><span></span><span class="n">year_2000</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;game_month&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;game_month&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_18_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Does this hold true across the dataset?</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span>
<span class="n">data_complete</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;game_date&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;game_month&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;game_month&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_21_0.png" /></p>
<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;game_day&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;game_day&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_22_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Unfortunately when we use the whole dataset the time differences seem to start to disappear, but I think they will stll be important</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s see how time affects things (period,minutes_remaining,seconds_remaining )</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">minutes_remaining</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Minutes Remaining&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Minutes&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage of shots made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">seconds_remaining</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Seconds Remaining&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Seconds&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage of shots made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">period</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Period&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Period&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage of shots made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_26_0.png" /></p>
<p><img alt="png" src="images/Kobe_26_1.png" /></p>
<p><img alt="png" src="images/Kobe_26_2.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Towards the end of his career, it&#39;s apparent Kobe was not shooting as well</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Now let&#39;s see if the opponenet mattered</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;opponent&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;opponent&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_29_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s see home vs away</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">matchup</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
<span class="n">data_complete</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;matchup&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">,</span><span class="s2">&quot;away&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;away&quot;</span><span class="p">)[</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">));</span>
</pre></div>


<p><img alt="png" src="images/Kobe_32_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Kobe shot slightly better at home it appears</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Although not drastic, it is still obvious Kobe shot better against some teams</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;loc_x&quot;</span><span class="p">,</span><span class="s2">&quot;loc_y&quot;</span><span class="p">,</span><span class="s2">&quot;shot_zone_area&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;shot_zone_area&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span> <span class="c1"># Optional, just adds 5% padding to the autoscaling</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">loc_x</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">loc_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_35_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s go through the location data</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">shot_zone_area</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zone Shot Area&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Zone&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage of shots made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_36_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#data_complete[&#39;shot_made_flag&#39;].groupby(data_complete.shot_zone_range).mean()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;loc_x&#39;</span><span class="p">],</span> <span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;loc_y&#39;</span><span class="p">],</span> <span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">75</span><span class="p">)</span>
<span class="c1">#new_groups = data_complete[[&quot;loc_x&quot;,&quot;loc_y&quot;,&quot;shot_zone_area&quot;,&quot;shot_made_flag&quot;]].groupby(&#39;shot_zone_area&#39;)</span>
<span class="c1">#print(list(groups[&#39;loc_x&#39;]))</span>
<span class="c1">#sns.kdeplot(setosa.sepal_width, setosa.sepal_length,</span>
<span class="c1">#                 cmap=&quot;Reds&quot;, shade=True, shade_lowest=False)</span>
</pre></div>


<div class="highlight"><pre><span></span>(-5, 75)
</pre></div>


<p><img alt="png" src="images/Kobe_37_1.png" /></p>
<div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[[</span><span class="s2">&quot;loc_x&quot;</span><span class="p">,</span><span class="s2">&quot;loc_y&quot;</span><span class="p">,</span><span class="s2">&quot;shot_zone_basic&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;shot_zone_basic&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span> <span class="c1"># Optional, just adds 5% padding to the autoscaling</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">loc_x</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">loc_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_38_0.png" /></p>
<div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">shot_zone_basic</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zone Shot Basic&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Zone&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage of shots made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s see what the x,y locations tell us</span>
<span class="n">shots_made</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">shots_missed</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">shots_missed</span><span class="p">[</span><span class="s1">&#39;loc_x&#39;</span><span class="p">],</span><span class="n">shots_missed</span><span class="p">[</span><span class="s1">&#39;loc_y&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Missed&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">shots_made</span><span class="p">[</span><span class="s1">&#39;loc_x&#39;</span><span class="p">],</span><span class="n">shots_made</span><span class="p">[</span><span class="s1">&#39;loc_y&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Made&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_41_0.png" /></p>
<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hexbin</span><span class="p">(</span><span class="n">shots_made</span><span class="p">[</span><span class="s1">&#39;loc_x&#39;</span><span class="p">],</span> <span class="n">shots_made</span><span class="p">[</span><span class="s1">&#39;loc_y&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_42_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#Let take a look at the spatial distribution of the check in points</span>
<span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">shots_made</span><span class="p">[</span><span class="s1">&#39;loc_x&#39;</span><span class="p">],</span> <span class="n">shots_made</span><span class="p">[</span><span class="s1">&#39;loc_y&#39;</span><span class="p">],</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span> <span class="c1">#</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;shots made heatmap&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_43_0.png" /></p>
<div class="highlight"><pre><span></span><span class="n">group_made</span> <span class="o">=</span> <span class="n">shots_made</span><span class="p">[[</span><span class="s2">&quot;loc_x&quot;</span><span class="p">,</span><span class="s2">&quot;loc_y&quot;</span><span class="p">,</span><span class="s2">&quot;shot_zone_range&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;shot_zone_range&#39;</span><span class="p">)</span>
<span class="n">group_missed</span> <span class="o">=</span> <span class="n">shots_missed</span><span class="p">[[</span><span class="s2">&quot;loc_x&quot;</span><span class="p">,</span><span class="s2">&quot;loc_y&quot;</span><span class="p">,</span><span class="s2">&quot;shot_zone_range&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;shot_zone_range&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span> <span class="c1"># Optional, just adds 5% padding to the autoscaling</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">group_made</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">loc_x</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">loc_y</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_44_0.png" /></p>
<div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">shot_zone_range</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Zone Shot Range&quot;</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Zone&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentage of shots made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_45_0.png" /></p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">data_complete</span><span class="p">[[</span><span class="s1">&#39;shot_distance&#39;</span><span class="p">,</span><span class="s1">&#39;shot_zone_range&#39;</span><span class="p">]])</span>
</pre></div>


<div class="highlight"><pre><span></span>       shot_distance  shot_zone_range
0                 15         8-16 ft.
1                 16        16-24 ft.
2                 22        16-24 ft.
3                  0  Less Than 8 ft.
4                 14         8-16 ft.
5                  0  Less Than 8 ft.
6                 12         8-16 ft.
7                 12         8-16 ft.
8                 25          24+ ft.
9                 17        16-24 ft.
10                12         8-16 ft.
11                 9         8-16 ft.
12                 5  Less Than 8 ft.
13                20        16-24 ft.
14                25          24+ ft.
15                16        16-24 ft.
16                14         8-16 ft.
17                18        16-24 ft.
18                11         8-16 ft.
19                18        16-24 ft.
20                 7  Less Than 8 ft.
21                 0  Less Than 8 ft.
22                20        16-24 ft.
23                26          24+ ft.
24                19        16-24 ft.
25                 8         8-16 ft.
26                12         8-16 ft.
27                13         8-16 ft.
28                20        16-24 ft.
29                27          24+ ft.
...              ...              ...
25667              0  Less Than 8 ft.
25668              5  Less Than 8 ft.
25669             10         8-16 ft.
25670              2  Less Than 8 ft.
25671             18        16-24 ft.
25672             25          24+ ft.
25673             17        16-24 ft.
25674              7  Less Than 8 ft.
25675              0  Less Than 8 ft.
25676             10         8-16 ft.
25677             11         8-16 ft.
25678             24          24+ ft.
25679             25          24+ ft.
25680             14         8-16 ft.
25681             18        16-24 ft.
25682              2  Less Than 8 ft.
25683              0  Less Than 8 ft.
25684             26          24+ ft.
25685             21        16-24 ft.
25686             13         8-16 ft.
25687             26          24+ ft.
25688             10         8-16 ft.
25689             13         8-16 ft.
25690             67  Back Court Shot
25691             15         8-16 ft.
25692              0  Less Than 8 ft.
25693              4  Less Than 8 ft.
25694             21        16-24 ft.
25695             26          24+ ft.
25696              7  Less Than 8 ft.

[25697 rows x 2 columns]
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Let&#39;s look at different distance metrics and see how they effect whether a shot was made</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_distance&#39;</span><span class="p">],</span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Shot distance vs Shot made&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/Kobe_47_0.png" /></p>
<div class="highlight"><pre><span></span><span class="c1">#There seems to be a cutoff distance wise once the shot is past 45 feet</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;shot_distance&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;shot_distance&#39;</span><span class="p">]</span> <span class="o">&lt;</span><span class="mi">45</span> <span class="k">else</span> <span class="mi">45</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>One immediate improvement we could make in the data set is to reduce the number of location-based columns</p>
<p>Right now we have lat, lon, loc_x,loc_y, shot_zone_area,shot_zone_basic for the region of the court </p>
<p>Additionally we have shot_distance, shot_type,shot_zone_range all describing pretty much the same thing</p>
<div class="highlight"><pre><span></span><span class="n">data_complete</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>       shot_distance  shot_zone_range
0                 15         8-16 ft.
1                 16        16-24 ft.
2                 22        16-24 ft.
3                  0  Less Than 8 ft.
4                 14         8-16 ft.
5                  0  Less Than 8 ft.
6                 12         8-16 ft.
7                 12         8-16 ft.
8                 25          24+ ft.
9                 17        16-24 ft.
10                12         8-16 ft.
11                 9         8-16 ft.
12                 5  Less Than 8 ft.
13                20        16-24 ft.
14                25          24+ ft.
15                16        16-24 ft.
16                14         8-16 ft.
17                18        16-24 ft.
18                11         8-16 ft.
19                18        16-24 ft.
20                 7  Less Than 8 ft.
21                 0  Less Than 8 ft.
22                20        16-24 ft.
23                26          24+ ft.
24                19        16-24 ft.
25                 8         8-16 ft.
26                12         8-16 ft.
27                13         8-16 ft.
28                20        16-24 ft.
29                27          24+ ft.
...              ...              ...
25667              0  Less Than 8 ft.
25668              5  Less Than 8 ft.
25669             10         8-16 ft.
25670              2  Less Than 8 ft.
25671             18        16-24 ft.
25672             25          24+ ft.
25673             17        16-24 ft.
25674              7  Less Than 8 ft.
25675              0  Less Than 8 ft.
25676             10         8-16 ft.
25677             11         8-16 ft.
25678             24          24+ ft.
25679             25          24+ ft.
25680             14         8-16 ft.
25681             18        16-24 ft.
25682              2  Less Than 8 ft.
25683              0  Less Than 8 ft.
25684             26          24+ ft.
25685             21        16-24 ft.
25686             13         8-16 ft.
25687             26          24+ ft.
25688             10         8-16 ft.
25689             13         8-16 ft.
25690             67  Back Court Shot
25691             15         8-16 ft.
25692              0  Less Than 8 ft.
25693              4  Less Than 8 ft.
25694             21        16-24 ft.
25695             26          24+ ft.
25696              7  Less Than 8 ft.

[25697 rows x 2 columns]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>[&#39;index&#39;,
 &#39;action_type&#39;,
 &#39;combined_shot_type&#39;,
 &#39;loc_x&#39;,
 &#39;loc_y&#39;,
 &#39;minutes_remaining&#39;,
 &#39;period&#39;,
 &#39;playoffs&#39;,
 &#39;season&#39;,
 &#39;seconds_remaining&#39;,
 &#39;shot_distance&#39;,
 &#39;shot_made_flag&#39;,
 &#39;shot_type&#39;,
 &#39;shot_zone_area&#39;,
 &#39;shot_zone_basic&#39;,
 &#39;shot_zone_range&#39;,
 &#39;opponent&#39;,
 &#39;shot_id&#39;,
 &#39;game_month&#39;,
 &#39;game_year&#39;,
 &#39;game_day&#39;,
 &#39;away&#39;,
 &#39;distance&#39;]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">categories</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;object&#39;</span>
<span class="n">categories</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">categories</span><span class="o">.</span><span class="n">values</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">categories</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>[&#39;action_type&#39;, &#39;combined_shot_type&#39;, &#39;season&#39;, &#39;shot_type&#39;, &#39;shot_zone_area&#39;, &#39;shot_zone_basic&#39;, &#39;shot_zone_range&#39;, &#39;opponent&#39;]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="o">.</span><span class="n">columns</span>
</pre></div>


<div class="highlight"><pre><span></span>Index([&#39;index&#39;, &#39;action_type&#39;, &#39;combined_shot_type&#39;, &#39;loc_x&#39;, &#39;loc_y&#39;,
       &#39;minutes_remaining&#39;, &#39;period&#39;, &#39;playoffs&#39;, &#39;season&#39;,
       &#39;seconds_remaining&#39;, &#39;shot_distance&#39;, &#39;shot_made_flag&#39;, &#39;shot_type&#39;,
       &#39;shot_zone_area&#39;, &#39;shot_zone_basic&#39;, &#39;shot_zone_range&#39;, &#39;opponent&#39;,
       &#39;shot_id&#39;, &#39;game_month&#39;, &#39;game_year&#39;, &#39;game_day&#39;, &#39;away&#39;, &#39;distance&#39;],
      dtype=&#39;object&#39;)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">categorial_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;action_type&#39;</span><span class="p">,</span> <span class="s1">&#39;combined_shot_type&#39;</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shot_zone_area&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_zone_basic&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_zone_range&#39;</span><span class="p">,</span> <span class="s1">&#39;game_year&#39;</span><span class="p">,</span>
    <span class="s1">&#39;game_month&#39;</span><span class="p">,</span> <span class="s1">&#39;opponent&#39;</span><span class="p">,</span> <span class="s1">&#39;loc_x&#39;</span><span class="p">,</span> <span class="s1">&#39;loc_y&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">categorial_cols</span><span class="p">:</span>
    <span class="n">dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data_complete</span><span class="p">[</span><span class="n">cc</span><span class="p">])</span>
    <span class="n">dummies</span> <span class="o">=</span> <span class="n">dummies</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s2">&quot;{}#&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cc</span><span class="p">))</span>
    <span class="n">data_complete</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data_complete</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dummies</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_complete</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>minutes_remaining</th>
      <th>playoffs</th>
      <th>seconds_remaining</th>
      <th>shot_distance</th>
      <th>shot_made_flag</th>
      <th>shot_id</th>
      <th>game_day</th>
      <th>away</th>
      <th>distance</th>
      <th>...</th>
      <th>loc_y#664</th>
      <th>loc_y#679</th>
      <th>loc_y#696</th>
      <th>loc_y#697</th>
      <th>loc_y#702</th>
      <th>loc_y#711</th>
      <th>loc_y#728</th>
      <th>loc_y#741</th>
      <th>loc_y#773</th>
      <th>loc_y#791</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>10</td>
      <td>0</td>
      <td>22</td>
      <td>15</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>True</td>
      <td>15</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>7</td>
      <td>0</td>
      <td>45</td>
      <td>16</td>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>True</td>
      <td>16</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>6</td>
      <td>0</td>
      <td>52</td>
      <td>22</td>
      <td>0</td>
      <td>4</td>
      <td>1</td>
      <td>True</td>
      <td>22</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>6</td>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>True</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>9</td>
      <td>0</td>
      <td>32</td>
      <td>14</td>
      <td>0</td>
      <td>6</td>
      <td>1</td>
      <td>True</td>
      <td>14</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 1113 columns</p>
</div>

<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Preliminary Machine Learning</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Separate dataset for training</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data_complete</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;shot_made_flag&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">data_complete</span><span class="p">[</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>False
</pre></div>


<div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="n">feature_imp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;importance&quot;</span><span class="p">])</span>
<span class="n">feat_imp_20</span> <span class="o">=</span> <span class="n">feature_imp</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;importance&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<span class="n">feat_imp_20</span>
</pre></div>


<div class="highlight"><pre><span></span>Index([&#39;index&#39;, &#39;shot_id&#39;, &#39;seconds_remaining&#39;, &#39;minutes_remaining&#39;,
       &#39;distance&#39;, &#39;shot_distance&#39;, &#39;game_day&#39;, &#39;action_type#Jump Shot&#39;,
       &#39;away&#39;, &#39;action_type#Layup Shot&#39;, &#39;combined_shot_type#Dunk&#39;, &#39;period#3&#39;,
       &#39;action_type#Running Jump Shot&#39;, &#39;action_type#Driving Layup Shot&#39;,
       &#39;period#2&#39;, &#39;period#1&#39;, &#39;period#4&#39;, &#39;game_month#3&#39;, &#39;game_month#12&#39;,
       &#39;game_month#1&#39;],
      dtype=&#39;object&#39;)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.90</span>
<span class="n">vt</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Find feature names</span>
<span class="n">feat_var_threshold</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">vt</span><span class="o">.</span><span class="n">variances_</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">threshold</span><span class="p">)]</span>
<span class="n">feat_var_threshold</span>
</pre></div>


<div class="highlight"><pre><span></span>Index([&#39;index&#39;, &#39;minutes_remaining&#39;, &#39;playoffs&#39;, &#39;seconds_remaining&#39;,
       &#39;shot_distance&#39;, &#39;shot_id&#39;, &#39;game_day&#39;, &#39;away&#39;, &#39;distance&#39;,
       &#39;action_type#Jump Shot&#39;, &#39;combined_shot_type#Jump Shot&#39;,
       &#39;combined_shot_type#Layup&#39;, &#39;period#1&#39;, &#39;period#2&#39;, &#39;period#3&#39;,
       &#39;period#4&#39;, &#39;shot_type#2PT Field Goal&#39;, &#39;shot_type#3PT Field Goal&#39;,
       &#39;shot_zone_area#Center(C)&#39;, &#39;shot_zone_area#Left Side Center(LC)&#39;,
       &#39;shot_zone_area#Left Side(L)&#39;, &#39;shot_zone_area#Right Side Center(RC)&#39;,
       &#39;shot_zone_area#Right Side(R)&#39;, &#39;shot_zone_basic#Above the Break 3&#39;,
       &#39;shot_zone_basic#In The Paint (Non-RA)&#39;, &#39;shot_zone_basic#Mid-Range&#39;,
       &#39;shot_zone_basic#Restricted Area&#39;, &#39;shot_zone_range#16-24 ft.&#39;,
       &#39;shot_zone_range#24+ ft.&#39;, &#39;shot_zone_range#8-16 ft.&#39;,
       &#39;shot_zone_range#Less Than 8 ft.&#39;, &#39;game_month#1&#39;, &#39;game_month#2&#39;,
       &#39;game_month#3&#39;, &#39;game_month#4&#39;, &#39;game_month#11&#39;, &#39;game_month#12&#39;,
       &#39;loc_x#0&#39;, &#39;loc_y#0&#39;],
      dtype=&#39;object&#39;)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">X_minmax</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_scored</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">chi2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_minmax</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
<span class="n">feature_scoring</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
        <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">X_scored</span><span class="o">.</span><span class="n">scores_</span>
    <span class="p">})</span>

<span class="n">feat_scored_20</span> <span class="o">=</span> <span class="n">feature_scoring</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)[</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">feat_scored_20</span>
</pre></div>


<div class="highlight"><pre><span></span>array([&#39;combined_shot_type#Dunk&#39;, &#39;action_type#Jump Shot&#39;,
       &#39;shot_zone_basic#Restricted Area&#39;, &#39;action_type#Driving Layup Shot&#39;,
       &#39;loc_x#0&#39;, &#39;loc_y#0&#39;, &#39;shot_zone_range#Less Than 8 ft.&#39;,
       &#39;action_type#Slam Dunk Shot&#39;, &#39;shot_type#3PT Field Goal&#39;,
       &#39;action_type#Driving Dunk Shot&#39;, &#39;shot_zone_area#Center(C)&#39;,
       &#39;action_type#Running Jump Shot&#39;, &#39;shot_zone_range#24+ ft.&#39;,
       &#39;shot_zone_basic#Above the Break 3&#39;, &#39;combined_shot_type#Layup&#39;,
       &#39;combined_shot_type#Jump Shot&#39;, &#39;distance&#39;,
       &#39;action_type#Jump Bank Shot&#39;, &#39;action_type#Pullup Jump shot&#39;,
       &#39;shot_zone_area#Left Side Center(LC)&#39;], dtype=object)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">rfe</span> <span class="o">=</span> <span class="n">RFE</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">rfe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>

<span class="n">feature_rfe_scoring</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;feature&#39;</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
        <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="n">rfe</span><span class="o">.</span><span class="n">ranking_</span>
    <span class="p">})</span>

<span class="n">feat_rfe_20</span> <span class="o">=</span> <span class="n">feature_rfe_scoring</span><span class="p">[</span><span class="n">feature_rfe_scoring</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;feature&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">feat_rfe_20</span>
</pre></div>


<div class="highlight"><pre><span></span>array([&#39;shot_distance&#39;, &#39;distance&#39;, &#39;action_type#Driving Dunk Shot&#39;,
       &#39;action_type#Driving Layup Shot&#39;, &#39;action_type#Jump Bank Shot&#39;,
       &#39;action_type#Jump Shot&#39;, &#39;action_type#Layup Shot&#39;,
       &#39;action_type#Pullup Jump shot&#39;, &#39;action_type#Running Jump Shot&#39;,
       &#39;action_type#Slam Dunk Shot&#39;, &#39;combined_shot_type#Dunk&#39;,
       &#39;combined_shot_type#Layup&#39;, &#39;period#4&#39;, &#39;season#2015-16&#39;,
       &#39;shot_zone_area#Left Side(L)&#39;, &#39;shot_zone_basic#Restricted Area&#39;,
       &#39;shot_zone_range#16-24 ft.&#39;, &#39;game_year#2006&#39;, &#39;game_year#2008&#39;,
       &#39;loc_x#0&#39;], dtype=object)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span>
        <span class="n">feat_var_threshold</span><span class="p">,</span> 
        <span class="n">feat_imp_20</span><span class="p">,</span>
        <span class="n">feat_scored_20</span><span class="p">,</span>
        <span class="n">feat_rfe_20</span>
    <span class="p">])</span>

<span class="n">features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Final features set:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">-{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>Final features set:

    -action_type#Driving Dunk Shot
    -action_type#Driving Layup Shot
    -action_type#Jump Bank Shot
    -action_type#Jump Shot
    -action_type#Layup Shot
    -action_type#Pullup Jump shot
    -action_type#Running Jump Shot
    -action_type#Slam Dunk Shot
    -away
    -combined_shot_type#Dunk
    -combined_shot_type#Jump Shot
    -combined_shot_type#Layup
    -distance
    -game_day
    -game_month#1
    -game_month#11
    -game_month#12
    -game_month#2
    -game_month#3
    -game_month#4
    -game_year#2006
    -game_year#2008
    -index
    -loc_x#0
    -loc_y#0
    -minutes_remaining
    -period#1
    -period#2
    -period#3
    -period#4
    -playoffs
    -season#2015-16
    -seconds_remaining
    -shot_distance
    -shot_id
    -shot_type#2PT Field Goal
    -shot_type#3PT Field Goal
    -shot_zone_area#Center(C)
    -shot_zone_area#Left Side Center(LC)
    -shot_zone_area#Left Side(L)
    -shot_zone_area#Right Side Center(RC)
    -shot_zone_area#Right Side(R)
    -shot_zone_basic#Above the Break 3
    -shot_zone_basic#In The Paint (Non-RA)
    -shot_zone_basic#Mid-Range
    -shot_zone_basic#Restricted Area
    -shot_zone_range#16-24 ft.
    -shot_zone_range#24+ ft.
    -shot_zone_range#8-16 ft.
    -shot_zone_range#Less Than 8 ft.
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Y</span><span class="o">.</span><span class="n">values</span>
</pre></div>


<div class="highlight"><pre><span></span>array([ 0.,  1.,  0., ...,  1.,  0.,  0.])
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Remember, features it the set of all the most important predictors in the data</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Try Linear Regression</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Initialize our algorithm class</span>
<span class="n">alg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_folds</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">:</span>
    <span class="c1"># The predictors we&#39;re using the train the algorithm.  Note how we only take the rows in the train folds.</span>
    <span class="n">train_predictors</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train</span><span class="p">,:])</span>
    <span class="c1"># The target we&#39;re using to train the algorithm.</span>
    <span class="n">train_target</span> <span class="o">=</span> <span class="n">Y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train</span><span class="p">]</span>
    <span class="c1"># Training the algorithm using the predictors and target.</span>
    <span class="n">alg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_predictors</span><span class="p">,</span> <span class="n">train_target</span><span class="p">)</span>
    <span class="c1"># We can now make predictions on the test fold</span>
    <span class="n">test_predictions</span> <span class="o">=</span> <span class="n">alg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test</span><span class="p">,:])</span>
    <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_predictions</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># The predictions are in three separate numpy arrays.  Concatenate them into one.  </span>
<span class="c1"># We concatenate them on axis 0, as they only have one axis.</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Map predictions to outcomes (only possible outcomes are 1 and 0)</span>
<span class="n">predictions</span><span class="p">[</span><span class="n">predictions</span> <span class="o">&gt;</span> <span class="o">.</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">predictions</span><span class="p">[</span><span class="n">predictions</span> <span class="o">&lt;=.</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">num_correct</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y</span> <span class="o">==</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">num_correct</span> <span class="o">=</span> <span class="n">num_correct</span><span class="p">[</span><span class="n">num_correct</span> <span class="o">==</span> <span class="bp">True</span><span class="p">]</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">num_correct</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>0.6430711756236136
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Logistic Regression</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Initialize our algorithm</span>
<span class="n">alg_log</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Compute the accuracy score for all the cross validation folds.  (much simpler than what we did before!)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">alg_log</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">Y</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="c1"># Take the mean of the scores (because we have one for each fold)</span>
<span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span>0.668132736904
</pre></div>


<div class="highlight"><pre><span></span><span class="n">alg_RF1</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span><span class="c1">#random_state=1, max_features=n_features,max_depth=None)</span>


<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">alg_RF1</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span><span class="n">Y</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span>0.567226403667
</pre></div>


<div class="highlight"><pre><span></span><span class="c1"># Initialize our algorithm with the default paramters</span>
<span class="c1"># n_estimators is the number of trees we want to make</span>
<span class="c1"># min_samples_split is the minimum number of rows we need to make a split</span>
<span class="c1"># min_samples_leaf is the minimum number of samples we can have at the place where a tree branch ends (the bottom points of the tree)</span>
<span class="n">alg_RF</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">alg_RF</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span><span class="n">Y</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span>0.555279453468
</pre></div>


<div class="highlight"><pre><span></span><span class="n">n_features</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_complete</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">n_features</span>
</pre></div>


<div class="highlight"><pre><span></span>1113
</pre></div>


<div class="highlight"><pre><span></span><span class="n">alg_RF1</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span><span class="n">max_depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">alg_RF1</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span><span class="n">Y</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span>0.558315086225
</pre></div>


<div class="highlight"><pre><span></span><span class="n">alg_GB</span> <span class="o">=</span> <span class="n">GradientBoostingClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">alg_GB</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span><span class="n">Y</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre><span></span>0.521112707179
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Trying XGBoost</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s2">&quot;XGBClassifier&quot;</span> <span class="o">+</span> <span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">clf_xgb</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.012</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="mf">0.62</span><span class="p">,</span> <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">clf_xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>----------XGBClassifier----------





XGBClassifier(base_score=0.5, colsample_bylevel=1, colsample_bytree=0.6,
       gamma=0, learning_rate=0.012, max_delta_step=0, max_depth=7,
       min_child_weight=1, missing=None, n_estimators=1000, nthread=-1,
       objective=&#39;binary:logistic&#39;, reg_alpha=0, reg_lambda=1,
       scale_pos_weight=1, seed=1, silent=True, subsample=0.62)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">label_xg</span> <span class="o">=</span> <span class="s2">&quot;XGBoost&quot;</span>
<span class="n">score</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf_xgb</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">Y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">) [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">score</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">score</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">label_xg</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Accuracy</span><span class="o">:</span> <span class="mf">0.50</span> <span class="o">(+/-</span> <span class="mf">0.04</span><span class="o">)</span> <span class="o">[</span><span class="n">XGBoost</span><span class="o">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Try Ensembling methods</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">BaseEstimator</span>
<span class="kn">from</span> <span class="nn">sklearn.base</span> <span class="kn">import</span> <span class="n">ClassifierMixin</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="k">class</span> <span class="nc">EnsembleClassifier</span><span class="p">(</span><span class="n">BaseEstimator</span><span class="p">,</span> <span class="n">ClassifierMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensemble classifier for scikit-learn estimators.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    clf : `iterable`</span>
<span class="sd">      A list of scikit-learn classifier objects.</span>
<span class="sd">    weights : `list` (default: `None`)</span>
<span class="sd">      If `None`, the majority rule voting will be applied to the predicted class labels.</span>
<span class="sd">        If a list of weights (`float` or `int`) is provided, the averaged raw probabilities (via `predict_proba`)</span>
<span class="sd">        will be used to determine the most confident class label.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clfs</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clfs</span> <span class="o">=</span> <span class="n">clfs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fit the scikit-learn estimators.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        X : numpy array, shape = [n_samples, n_features]</span>
<span class="sd">            Training data</span>
<span class="sd">        y : list or numpy array, shape = [n_samples]</span>
<span class="sd">            Class labels</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clfs</span><span class="p">:</span>
            <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        X : numpy array, shape = [n_samples, n_features]</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>

<span class="sd">        maj : list or numpy array, shape = [n_samples]</span>
<span class="sd">            Predicted class labels by majority rule</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">classes_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clfs</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">:</span>
            <span class="n">avg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

            <span class="n">maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">arr</span><span class="o">=</span><span class="n">avg</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">maj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_</span><span class="p">[:,</span><span class="n">c</span><span class="p">]))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])])</span>

        <span class="k">return</span> <span class="n">maj</span>

    <span class="k">def</span> <span class="nf">predict_proba</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        X : numpy array, shape = [n_samples, n_features]</span>

<span class="sd">        Returns</span>
<span class="sd">        ----------</span>

<span class="sd">        avg : list or numpy array, shape = [n_samples, n_probabilities]</span>
<span class="sd">            Weighted average probability for each class per sample.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probas_</span> <span class="o">=</span> <span class="p">[</span><span class="n">clf</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="k">for</span> <span class="n">clf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">clfs</span><span class="p">]</span>
        <span class="n">avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">probas_</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">avg</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">eclf</span> <span class="o">=</span> <span class="n">EnsembleClassifier</span><span class="p">(</span><span class="n">clfs</span><span class="o">=</span><span class="p">[</span><span class="n">alg_log</span><span class="p">,</span> <span class="n">alg_RF1</span><span class="p">,</span> <span class="n">clf_xgb</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">clf</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">alg_log</span><span class="p">,</span> <span class="n">alg_RF1</span><span class="p">,</span> <span class="n">clf_xgb</span><span class="p">,</span><span class="n">eclf</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;XGBoost&#39;</span><span class="p">,</span> <span class="s1">&#39;Ensemble&#39;</span><span class="p">]):</span>

    <span class="n">scores</span> <span class="o">=</span> <span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span> <span class="n">Y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Accuracy: </span><span class="si">%0.2f</span><span class="s2"> (+/- </span><span class="si">%0.2f</span><span class="s2">) [</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">scores</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span> <span class="n">label</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nl">Accuracy</span><span class="p">:</span> <span class="mf">0.65</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.01</span><span class="p">)</span> <span class="p">[</span><span class="n">Logistic</span> <span class="n">Regression</span><span class="p">]</span>
<span class="nl">Accuracy</span><span class="p">:</span> <span class="mf">0.56</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.08</span><span class="p">)</span> <span class="p">[</span><span class="n">Random</span> <span class="n">Forest</span><span class="p">]</span>
<span class="nl">Accuracy</span><span class="p">:</span> <span class="mf">0.50</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.04</span><span class="p">)</span> <span class="p">[</span><span class="n">XGBoost</span><span class="p">]</span>
<span class="nl">Accuracy</span><span class="p">:</span> <span class="mf">0.54</span> <span class="p">(</span><span class="o">+/-</span> <span class="mf">0.07</span><span class="p">)</span> <span class="p">[</span><span class="n">Ensemble</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">#Prepare submit data</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;game_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;game_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;game_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;game_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_submit</span><span class="o">.</span><span class="n">matchup</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">)</span>
<span class="n">data_submit</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;matchup&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_submit</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;shot_distance&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;shot_distance&#39;</span><span class="p">]</span> <span class="o">&lt;</span><span class="mi">45</span> <span class="k">else</span> <span class="mi">45</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">data_submit</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;game_date&quot;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;shot_made_flag&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">categorial_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;action_type&#39;</span><span class="p">,</span> <span class="s1">&#39;combined_shot_type&#39;</span><span class="p">,</span> <span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_type&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shot_zone_area&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_zone_basic&#39;</span><span class="p">,</span> <span class="s1">&#39;shot_zone_range&#39;</span><span class="p">,</span> <span class="s1">&#39;game_year&#39;</span><span class="p">,</span>
    <span class="s1">&#39;game_month&#39;</span><span class="p">,</span> <span class="s1">&#39;opponent&#39;</span><span class="p">,</span> <span class="s1">&#39;loc_x&#39;</span><span class="p">,</span> <span class="s1">&#39;loc_y&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">categorial_cols</span><span class="p">:</span>
    <span class="n">dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data_submit</span><span class="p">[</span><span class="n">cc</span><span class="p">])</span>
    <span class="n">dummies</span> <span class="o">=</span> <span class="n">dummies</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s2">&quot;{}#&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cc</span><span class="p">))</span>
    <span class="n">data_submit</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">data_submit</span> <span class="o">=</span> <span class="n">data_submit</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dummies</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">data_submit</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>minutes_remaining</th>
      <th>playoffs</th>
      <th>seconds_remaining</th>
      <th>shot_distance</th>
      <th>shot_id</th>
      <th>game_day</th>
      <th>away</th>
      <th>distance</th>
      <th>action_type#Alley Oop Dunk Shot</th>
      <th>...</th>
      <th>loc_y#485</th>
      <th>loc_y#493</th>
      <th>loc_y#496</th>
      <th>loc_y#503</th>
      <th>loc_y#527</th>
      <th>loc_y#528</th>
      <th>loc_y#548</th>
      <th>loc_y#564</th>
      <th>loc_y#587</th>
      <th>loc_y#592</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>27</td>
      <td>18</td>
      <td>1</td>
      <td>1</td>
      <td>True</td>
      <td>18</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>7</td>
      <td>8</td>
      <td>0</td>
      <td>5</td>
      <td>2</td>
      <td>8</td>
      <td>1</td>
      <td>True</td>
      <td>2</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>16</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>17</td>
      <td>2</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19</td>
      <td>10</td>
      <td>0</td>
      <td>46</td>
      <td>0</td>
      <td>20</td>
      <td>2</td>
      <td>False</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>32</td>
      <td>11</td>
      <td>0</td>
      <td>26</td>
      <td>17</td>
      <td>33</td>
      <td>5</td>
      <td>True</td>
      <td>17</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 958 columns</p>
</div>

<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">makeSubmission</span><span class="p">(</span><span class="n">alg</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="n">alg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">features</span><span class="p">],</span><span class="n">Y</span><span class="p">)</span>
    <span class="n">target_y</span> <span class="o">=</span> <span class="n">alg_log</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">data_submit</span><span class="p">[</span><span class="n">features</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">target_id</span> <span class="o">=</span> <span class="n">data_submit</span><span class="p">[</span><span class="s2">&quot;shot_id&quot;</span><span class="p">]</span>
    <span class="n">submission</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;shot_id&quot;</span><span class="p">:</span><span class="n">target_id</span><span class="p">,</span> <span class="s2">&quot;shot_made_flag&quot;</span><span class="p">:</span><span class="n">target_y</span><span class="p">})</span>
    <span class="n">submission</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;shot_id&#39;</span><span class="p">,</span>  <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">submission</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;KobeSubmission{}.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">makeSubmission</span><span class="p">(</span><span class="n">alg_log</span><span class="p">,</span><span class="s2">&quot;Log&quot;</span><span class="p">)</span>
<span class="n">makeSubmission</span><span class="p">(</span><span class="n">alg_RF1</span><span class="p">,</span><span class="s2">&quot;RandomForest&quot;</span><span class="p">)</span>
<span class="n">makeSubmission</span><span class="p">(</span><span class="n">clf_xgb</span><span class="p">,</span><span class="s2">&quot;XGBoost&quot;</span><span class="p">)</span>
<span class="n">makeSubmission</span><span class="p">(</span><span class="n">eclf</span><span class="p">,</span><span class="s2">&quot;Ensemble&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="/nyc-cab-project.html" rel="bookmark"
                           title="Permalink to NYC Cab Project">NYC Cab Project</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-08-15T00:00:00+00:00">
                Published: Mon 15 August 2016
        </abbr>

<p>In <a href="/category/machine-learning.html">Machine Learning</a>.</p>

</footer><!-- /.post-info -->                <div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
<span class="kn">import</span> <span class="nn">shapefile</span>
<span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">MultiPoint</span><span class="p">,</span> <span class="n">MultiPolygon</span>
<span class="kn">from</span> <span class="nn">shapely.prepared</span> <span class="kn">import</span> <span class="n">prep</span>
<span class="kn">from</span> <span class="nn">descartes</span> <span class="kn">import</span> <span class="n">PolygonPatch</span>
<span class="kn">import ...</span></pre></div>
                <a class="readmore" href="/nyc-cab-project.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://twitter.com"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
                <li class="list-group-item"><a href="https://github.com"><i class="fa fa-github-square fa-lg"></i> github</a></li>
                <li class="list-group-item"><a href="https://linkedin.com"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
              </ul>
            </li>



            <li class="list-group-item"><a href="http://sensitivecities.com/"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group " id="tags">
                </ul>
            </li>
    </ul>
</section>
</body>
</html>